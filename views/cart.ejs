<%- include('./partials/header') %>
<% user.cart.forEach(function(item){ %>
<div class="w-full min-h-screen flex flex-wrap px-20 py-20 gap-10">
  <% if(cart.length === 0) { %>
  <div class="w-full flex items-center justify-center">
    <h2 class="text-2xl font-semibold text-gray-700">Your cart is empty!</h2>
  </div>
  <% } else { %> <% cart.forEach(function(item) { %>
  <div class="w-[30%] rounded-md overflow-hidden shadow-md">
    <div class="w-full h-80 bg-yellow-500">
      <% if (item?.product?.image) { %>
      <img
        class="w-full h-full object-cover"
        src="data:<%= item.product.image.contentType %>;base64,<%= item.product.image.data.toString('base64') %>"
        alt="<%= item.product.name %>"
      />
      <% } else { %>
      <div
        class="w-full h-full flex items-center justify-center text-white text-lg"
      >
        No image
      </div>
      <% } %>
    </div>
    <div class="w-full flex justify-between items-center px-5 py-4">
      <h3 class="text-xl font-semibold"><%= item.product.name %></h3>
      <div class="flex items-center gap-2">
        <!-- Increment -->
        <form action="/cart/increment/<%= item.product._id %>" method="POST">
          <button
            type="submit"
            class="w-7 h-7 bg-white flex rounded-full items-center justify-center border"
          >
            <i class="ri-add-line"></i>
          </button>
        </form>

        <div class="px-2 py-1 rounded-md bg-white text-black border">
          <%= item.quantity %>
        </div>

        <!-- Decrement -->
        <form action="/cart/decrement/<%= item.product._id %>" method="POST">
          <button
            type="submit"
            class="w-7 h-7 bg-white flex rounded-full items-center justify-center border"
          >
            <i class="ri-subtract-line"></i>
          </button>
        </form>

        <!-- Remove -->
        <form action="/cart/remove/<%= item.product._id %>" method="POST">
          <button type="submit" class="text-red-600 text-sm hover:underline">
            Remove
          </button>
        </form>
      </div>
    </div>
    <div class="flex items-center justify-between px-5 py-3">
      <h4 class="text-lg">Net Total</h4>
      <h2 class="text-lg font-semibold">
        ₹ <%= item.product.price * item.quantity %>
      </h2>
    </div>
  </div>
  <% }) %>

  <div class="w-[65%]">
    <h3 class="text-xl font-semibold mb-3">Price Breakdown</h3>
    <div class="px-10 space-y-2 text-gray-700">
      <div class="flex">
        <h4 class="w-1/3">Total MRP</h4>
        <h4>
          ₹ <%= cart.reduce((acc, item) => acc + item.product.price *
          item.quantity, 0) %>
        </h4>
      </div>
      <div class="flex">
        <h4 class="w-1/3">Discount on MRP</h4>
        <h4>₹ 0</h4>
      </div>
      <div class="flex">
        <h4 class="w-1/3">Platform Fee</h4>
        <h4>₹ 20</h4>
      </div>
      <div class="flex">
        <h4 class="w-1/3">Shipping Fee</h4>
        <h4>FREE</h4>
      </div>
    </div>

    <div class="w-full h-[1px] bg-black my-6"></div>

    <div class="flex">
      <h3 class="w-1/3 text-xl font-semibold">Total Amount</h3>
      <h3 class="font-bold text-xl text-green-600">
        ₹ <%= cart.reduce((acc, item) => acc + item.product.price *
        item.quantity, 0) + 20 %>
      </h3>
    </div>
  </div>
</div>
<% }) %>

<%- include('./partials/footer') %>
